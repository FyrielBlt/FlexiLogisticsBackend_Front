{"ast":null,"code":"import swal from \"sweetalert2\";\nwindow.Swal = swal;\nimport axios from \"axios\";\nimport Url from \"../../../store/Api\";\nimport { mapGetters } from \"vuex\";\nimport BreadCrumb from \"../../../components/Intermediaire/BreadCrumb.vue\";\nimport PaginationVue from \"../../../components/Intermediaire/pagination/PaginationVue.vue\";\nexport default {\n  components: {\n    BreadCrumb,\n    PaginationVue\n  },\n\n  data() {\n    return {\n      ParpageTransporteur: \"1\",\n      rechercheTransporteur: \"\",\n      rechercheVille1: \"\",\n      rechercheVille2: \"\",\n      Description: \"\",\n      DateCreation: \"\",\n      AdressDepart: \"\",\n      AdressArrive: \"\",\n      IdEtatDemande: \"\",\n      IdClient: \"\",\n      Date: \"\",\n      Poids: \"\",\n      Largeur: \"\",\n      Hauteur: \"\",\n      checkedTransporteur: [],\n      checkedTransporteurId: []\n    };\n  },\n\n  computed: { ...mapGetters([\"ListeTransporteurs\", \"ListeEtatDemandeDevis\", \"ListeDemandeDevis\", \"ListeEtatDemandeLivraisons\", \"currentTransporteur\", \"perPageTransporteur\", \"parPageTransporteur\", \"totalTransporteur\", \"ChercherVille1\", \"ChercherVille2\"])\n  },\n\n  mounted() {\n    this.$store.dispatch(\"Get_Transporteur\");\n    this.$store.dispatch(\"Get_EtatDemandeDevi\");\n    this.$store.dispatch(\"Get_DemandeDevi\", this.$route.params.id);\n    this.$store.dispatch(\"Get_EtatDemandeLivraison\");\n  },\n\n  async created() {\n    await axios.get(Url + `DemandeDevis/${this.$route.params.id}`, {\n      headers: {\n        Authorization: \"Bearer \" + localStorage.getItem(\"token\")\n      }\n    }).then(res => {\n      this.checkedTransporteurId = res.data.map(el => el.idTransporteurNavigation).map(el => el.idTransporteur);\n      this.checkedTransporteur = res.data.map(el => el.idTransporteurNavigation);\n    });\n    await axios.get(Url + \"DemandeLivraisons/\" + this.$route.params.id, {\n      headers: {\n        Authorization: \"Bearer \" + localStorage.getItem(\"token\")\n      }\n    }).then(res => {\n      console.log(res.data[0]);\n      this.id = res.data[0].idDemande;\n      this.Description = res.data[0].description;\n      this.DateCreation = res.data[0].datecreation;\n      this.AdressDepart = res.data[0].adressdepart;\n      this.AdressArrive = res.data[0].adressarrive;\n      this.IdEtatDemande = res.data[0].idEtatdemande;\n      this.IdClient = res.data[0].idclient;\n      this.Date = res.data[0].date;\n      this.Poids = res.data[0].poids;\n      this.Largeur = res.data[0].largeur;\n      this.Hauteur = res.data[0].hauteur;\n    });\n  },\n\n  methods: {\n    GetEtatDemandeDevis() {\n      return this.ListeEtatDemandeDevis.filter(el => el.etat == \"Non traité\").map(el => el.idEtat)[0];\n    },\n\n    GetEtatDemande() {\n      return this.ListeEtatDemandeLivraisons.filter(el => el.etatDemande == \"En cours de traitement\").map(el => el.idEtatDemande)[0];\n    },\n\n    GetEtatDemandeModifier() {\n      return this.ListeEtatDemandeLivraisons.filter(el => el.etatDemande == \"Non traité\").map(el => el.idEtatDemande)[0];\n    },\n\n    Ajouter() {\n      let DemandeDevi = {\n        DateEnvoit: \"2022-04-07\",\n        IdIntermediaire: localStorage.getItem(\"id\"),\n        IdDemande: this.$route.params.id,\n        IdTransporteur: this.checkedTransporteurId,\n        IdEtat: this.GetEtatDemandeDevis()\n      };\n\n      if (this.checkedTransporteurId.length != 0) {\n        this.$store.dispatch(\"Ajouter_DemandeDevi\", DemandeDevi);\n        var DemandeLivraison = {\n          idDemande: this.$route.params.id,\n          description: this.Description,\n          datecreation: this.DateCreation,\n          adressdepart: this.AdressDepart,\n          adressarrive: this.AdressArrive,\n          idEtatdemande: this.GetEtatDemande(),\n          idclient: this.IdClient,\n          Date: this.Date,\n          Poids: this.Poids,\n          Largeur: this.Largeur,\n          Hauteur: this.Hauteur\n        };\n      } else {\n        var DemandeLivraison = {\n          idDemande: this.$route.params.id,\n          description: this.Description,\n          datecreation: this.DateCreation,\n          adressdepart: this.AdressDepart,\n          adressarrive: this.AdressArrive,\n          idEtatdemande: this.GetEtatDemandeModifier(),\n          idclient: this.IdClient,\n          Date: this.Date,\n          Poids: this.Poids,\n          Largeur: this.Largeur,\n          Hauteur: this.Hauteur\n        };\n        this.$swal({\n          position: \"top-end\",\n          icon: \"error\",\n          toast: true,\n          title: \"Il faut choisir au moins transporteur\",\n          showConfirmButton: false,\n          timer: 2000\n        });\n      }\n\n      console.log(DemandeLivraison); // changer l'etat du demande de en cour de traitemment a traiter\n\n      axios.put(Url + \"DemandeLivraisons/\" + DemandeLivraison.idDemande, DemandeLivraison, {\n        headers: {\n          Authorization: \"Bearer \" + localStorage.getItem(\"token\")\n        }\n      }).then();\n    },\n\n    Modifier() {\n      if (this.checkedTransporteurId.length != 0) {\n        let DemandeDevi = {\n          DateEnvoit: \"2022-04-07\",\n          IdIntermediaire: localStorage.getItem(\"id\"),\n          IdDemande: this.$route.params.id,\n          IdTransporteur: this.checkedTransporteurId,\n          IdEtat: this.GetEtatDemandeDevis()\n        };\n        console.log(DemandeDevi);\n        this.$store.dispatch(\"Modifier_DemandeDevi\", DemandeDevi);\n        this.Ajouter();\n      } else {\n        this.$swal({\n          position: \"top-end\",\n          icon: \"error\",\n          toast: true,\n          title: \"Il faut choisir au moins transporteur\",\n          showConfirmButton: false,\n          timer: 2000\n        });\n      }\n    },\n\n    ChangePage(NumPage) {\n      if (this.rechercheVille1 != \"\" && this.rechercheTransporteur != \"\") {\n        this.$store.dispatch(\"Get_NoveauTrajet\", NumPage);\n      } else {\n        this.$store.dispatch(\"Get_NoveauTransporteur\", NumPage);\n      }\n    }\n\n  },\n  watch: {\n    ParpageTransporteur() {\n      if (this.rechercheVille1 != \"\") {\n        this.$store.dispatch(\"Changer_ParpageTrajet\", this.ParpageTransporteur);\n      } else {\n        this.$store.dispatch(\"Changer_ParpageTransporteur\", this.ParpageTransporteur);\n      }\n    },\n\n    rechercheTransporteur() {\n      let ville = {\n        ville1: this.rechercheVille1,\n        name: this.rechercheTransporteur\n      };\n      this.$store.dispatch(\"Chercher_Trajet\", ville);\n    },\n\n    rechercheVille1() {\n      if (this.rechercheVille1 != \"\") {\n        let ville = {\n          ville1: this.rechercheVille1,\n          name: this.rechercheTransporteur\n        };\n        console.log(ville);\n        this.$store.dispatch(\"Chercher_Trajet\", ville);\n      } else {\n        this.$store.dispatch(\"Get_Transporteur\", this.rechercheTransporteur);\n      }\n    },\n\n    checkedTransporteurId() {\n      //let leng=this.checkedTransporteurId.length-1;\n      this.checkedTransporteur = [];\n      let i;\n\n      for (i = 0; i < this.checkedTransporteurId.length; i++) {\n        axios.get(Url + \"Transporteurs/\" + this.checkedTransporteurId[i], {\n          headers: {\n            Authorization: \"Bearer \" + localStorage.getItem(\"token\")\n          }\n        }).then(res => {\n          this.checkedTransporteur.push(res.data);\n        });\n      }\n    }\n\n  }\n};","map":{"version":3,"mappings":"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","names":["swal","window","Swal","axios","Url","mapGetters","BreadCrumb","PaginationVue","components","data","ParpageTransporteur","rechercheTransporteur","rechercheVille1","rechercheVille2","Description","DateCreation","AdressDepart","AdressArrive","IdEtatDemande","IdClient","Date","Poids","Largeur","Hauteur","checkedTransporteur","checkedTransporteurId","computed","mounted","$store","dispatch","$route","params","id","created","get","headers","Authorization","localStorage","getItem","then","res","map","el","idTransporteurNavigation","idTransporteur","console","log","idDemande","description","datecreation","adressdepart","adressarrive","idEtatdemande","idclient","date","poids","largeur","hauteur","methods","GetEtatDemandeDevis","ListeEtatDemandeDevis","filter","etat","idEtat","GetEtatDemande","ListeEtatDemandeLivraisons","etatDemande","idEtatDemande","GetEtatDemandeModifier","Ajouter","DemandeDevi","DateEnvoit","IdIntermediaire","IdDemande","IdTransporteur","IdEtat","length","DemandeLivraison","$swal","position","icon","toast","title","showConfirmButton","timer","put","Modifier","ChangePage","NumPage","watch","ville","ville1","name","i","push"],"sourceRoot":"","sources":["C:\\Users\\user\\Desktop\\pfe\\frontfinal\\src\\views\\Intermediaire\\demande\\DemandeDevis.vue"],"sourcesContent":["<template>\r\n  <div>\r\n    <!-- Breadcrumb -->\r\n    <!-- <Breadcrumb :breadcrumbName=\"Tables\" /> -->\r\n    <bread-crumb>\r\n      <template v-slot:bread1> Demandes </template>\r\n      <template v-slot:bread> Demande Devi </template>\r\n    </bread-crumb>\r\n\r\n    <div class=\"mt-8\">\r\n      <div class=\"mt-6\">\r\n        <h2 class=\"text-xl font-semibold leading-tight text-gray-700\">\r\n          Les Transporteurs\r\n        </h2>\r\n\r\n        <div class=\"flex flex-col mt-3 text-center sm:flex-row\">\r\n          <div class=\"flex\">\r\n            <div class=\"relative\">\r\n              <select\r\n                class=\"\r\n                  block\r\n                  w-full\r\n                  h-full\r\n                  px-4\r\n                  py-2\r\n                  pr-8\r\n                  leading-tight\r\n                  text-gray-700\r\n                  bg-white\r\n                  border border-gray-400\r\n                  rounded-l\r\n                  appearance-none\r\n                  focus:outline-none focus:bg-white focus:border-gray-500\r\n                \"\r\n                v-model=\"ParpageTransporteur\"\r\n              >\r\n                <option value=\"1\">1</option>\r\n                <option value=\"10\">10</option>\r\n                <option value=\"20\">20</option>\r\n              </select>\r\n\r\n              <div\r\n                class=\"\r\n                  absolute\r\n                  inset-y-0\r\n                  right-0\r\n                  flex\r\n                  items-center\r\n                  px-2\r\n                  text-gray-700\r\n                  pointer-events-none\r\n                \"\r\n              >\r\n                <svg\r\n                  class=\"w-4 h-4 fill-current\"\r\n                  xmlns=\"http://www.w3.org/2000/svg\"\r\n                  viewBox=\"0 0 20 20\"\r\n                >\r\n                  <path\r\n                    d=\"M9.293 12.95l.707.707L15.657 8l-1.414-1.414L10 10.828 5.757 6.586 4.343 8z\"\r\n                  />\r\n                </svg>\r\n              </div>\r\n            </div>\r\n\r\n            <div class=\"relative\">\r\n              <div\r\n                class=\"\r\n                  absolute\r\n                  inset-y-0\r\n                  right-0\r\n                  flex\r\n                  items-center\r\n                  px-2\r\n                  text-gray-700\r\n                  pointer-events-none\r\n                \"\r\n              >\r\n                <svg\r\n                  class=\"w-4 h-4 fill-current\"\r\n                  xmlns=\"http://www.w3.org/2000/svg\"\r\n                  viewBox=\"0 0 20 20\"\r\n                >\r\n                  <path\r\n                    d=\"M9.293 12.95l.707.707L15.657 8l-1.414-1.414L10 10.828 5.757 6.586 4.343 8z\"\r\n                  />\r\n                </svg>\r\n              </div>\r\n            </div>\r\n          </div>\r\n\r\n          <div class=\"relative block mt-2 sm:mt-0\">\r\n            <span class=\"absolute inset-y-0 left-0 flex items-center pl-2\">\r\n              <svg\r\n                viewBox=\"0 0 24 24\"\r\n                class=\"w-4 h-4 text-gray-500 fill-current\"\r\n              >\r\n                <path\r\n                  d=\"M10 4a6 6 0 100 12 6 6 0 000-12zm-8 6a8 8 0 1114.32 4.906l5.387 5.387a1 1 0 01-1.414 1.414l-5.387-5.387A8 8 0 012 10z\"\r\n                />\r\n              </svg>\r\n            </span>\r\n\r\n            <input\r\n              placeholder=\"Search\"\r\n              class=\"\r\n                block\r\n                w-full\r\n                py-2\r\n                pl-8\r\n                pr-6\r\n                text-xm text-gray-700\r\n                placeholder-gray-400\r\n                bg-white\r\n                border border-b border-gray-400\r\n                rounded-l rounded-r\r\n                appearance-none\r\n                sm:rounded-l-none\r\n                focus:bg-white\r\n                focus:placeholder-gray-600\r\n                focus:text-gray-700\r\n                focus:outline-none\r\n              \"\r\n              v-model=\"rechercheTransporteur\"\r\n            />\r\n          </div>\r\n         \r\n          <div class=\"relative block mt-2 sm:mt-0\">\r\n            <span class=\"absolute inset-y-0 left-0 flex items-center pl-2\">\r\n              <svg\r\n                viewBox=\"0 0 24 24\"\r\n                class=\"w-4 h-4 text-gray-500 fill-current\"\r\n              >\r\n                <path\r\n                  d=\"M10 4a6 6 0 100 12 6 6 0 000-12zm-8 6a8 8 0 1114.32 4.906l5.387 5.387a1 1 0 01-1.414 1.414l-5.387-5.387A8 8 0 012 10z\"\r\n                />\r\n              </svg>\r\n            </span>\r\n\r\n            <input\r\n              placeholder=\"Ville 1\"\r\n              class=\"\r\n                block\r\n                w-full\r\n                py-2\r\n                pl-8\r\n                pr-6\r\n                text-xm text-gray-700\r\n                placeholder-gray-400\r\n                bg-white\r\n                border border-b border-gray-400\r\n                rounded-l rounded-r\r\n                appearance-none\r\n                sm:rounded-l-none\r\n                focus:bg-white\r\n                focus:placeholder-gray-600\r\n                focus:text-gray-700\r\n                focus:outline-none\r\n              \"\r\n              v-model=\"rechercheVille1\"\r\n            />\r\n          </div>\r\n         \r\n        </div>\r\n\r\n        <div class=\"px-4 py-4 -mx-4 overflow-x-auto sm:-mx-8 sm:px-8\">\r\n          <div\r\n            class=\"inline-block min-w-full overflow-hidden rounded-lg shadow\"\r\n          >\r\n            <table class=\"min-w-full leading-normal\">\r\n              <thead>\r\n                <tr>\r\n                  <th\r\n                    class=\"\r\n                      px-5\r\n                      py-3\r\n                      text-sm\r\n                      font-medium\r\n                      text-gray-100\r\n                      uppercase\r\n                      bg-indigo-800\r\n                    \"\r\n                  >\r\n                    ID\r\n                  </th>\r\n                  <th\r\n                    class=\"\r\n                      px-5\r\n                      py-3\r\n                      text-sm\r\n                      font-medium\r\n                      text-gray-100\r\n                      uppercase\r\n                      bg-indigo-800\r\n                    \"\r\n                  >\r\n                    User\r\n                  </th>\r\n\r\n                  <th\r\n                    class=\"\r\n                      px-5\r\n                      py-3\r\n                      text-sm\r\n                      font-medium\r\n                      text-gray-100\r\n                      uppercase\r\n                      bg-indigo-800\r\n                    \"\r\n                  >\r\n                    Settings\r\n                  </th>\r\n                </tr>\r\n              </thead>\r\n              <!-- liste transporteur -->\r\n              <tbody class=\"bg-white\">\r\n                <tr\r\n                  v-for=\"(transporteur, index) in ListeTransporteurs\"\r\n                  :key=\"transporteur.idTransporteur\"\r\n                >\r\n                \r\n                  <th\r\n                    class=\"px-6 py-4 border-b border-gray-200 whitespace-nowrap\"\r\n                  >\r\n                    {{ index + 1 }}\r\n                  </th>\r\n                  <td\r\n                    class=\"\r\n                      px-6\r\n                      py-4\r\n                      border-b\r\n                      text-center\r\n                      border-gray-200\r\n                      whitespace-nowrap\r\n                      text-center\r\n                    \"\r\n                  >\r\n                    <div class=\"flex justify-around\">\r\n                      <div class=\"flex-shrink-0 w-10 h-10\">\r\n                        <img\r\n                          class=\"w-10 h-10 rounded-full\"\r\n                          :src=\"transporteur.imageSrc\"\r\n                          alt=\"\"\r\n                        />\r\n                      </div>\r\n\r\n                      <div class=\"ml-4\">\r\n                        <div class=\"px-6 py-2 border-b border-gray-200\">\r\n                          {{ transporteur.idUserNavigation.prenom }}\r\n\r\n                          {{ transporteur.idUserNavigation.nom }}\r\n                        </div>\r\n                      </div>\r\n                    </div>\r\n                  </td>\r\n\r\n                  <td\r\n                    class=\"\r\n                      px-6\r\n                      py-4\r\n                      text-sm\r\n                      font-medium\r\n                      leading-5\r\n                      text-center\r\n                      border-b border-gray-200\r\n                      whitespace-nowrap\r\n                    \"\r\n                  >\r\n                    <input\r\n                      type=\"checkbox\"\r\n                      class=\"\r\n                        w-5\r\n                        h-5\r\n                        text-indigo-600\r\n                        rounded-md\r\n                        focus:ring-indigo-500\r\n                      \"\r\n                      :id=\"transporteur.idTransporteur\"\r\n                      :value=\"transporteur.idTransporteur\"\r\n                      v-model=\"checkedTransporteurId\"\r\n                      name=\"radio\"\r\n                    />\r\n                  </td>\r\n                </tr>\r\n              </tbody>\r\n            </table>\r\n           \r\n                <div class=\"text-center \">\r\n                  <div\r\n                    class=\"\r\n                      flex flex-col\r\n                      items-center\r\n                      bg-white\r\n                      xs:flex-row xs:justify-between\r\n                    \"\r\n                  >\r\n                    <div class=\"inline-flex xs:mt-0\">\r\n                      <!-- PAGINATION -->\r\n                      <pagination-vue\r\n                        :current=\"currentTransporteur\"\r\n                        :total=\"totalTransporteur\"\r\n                        :per-page=\"perPageTransporteur\"\r\n                        @page-changed=\"ChangePage\"\r\n                      ></pagination-vue>\r\n                    </div>\r\n                  </div>\r\n                </div>\r\n               \r\n          </div>\r\n        </div>\r\n      </div>\r\n    </div>\r\n    <div class=\"mt\" v-if=\"checkedTransporteurId.length\">\r\n      <h2 class=\"text-xl font-semibold leading-tight text-gray-700\">\r\n        {{ checkedTransporteurId.length }} Transporteur select :\r\n      </h2>\r\n\r\n      <div class=\"flex flex-col mt-6\">\r\n        <div\r\n          class=\"py-2 -my-2 overflow-x-auto sm:-mx-6 sm:px-6 lg:-mx-8 lg:px-8\"\r\n        >\r\n          <div\r\n            class=\"\r\n              inline-block\r\n              min-w-full\r\n              overflow-hidden\r\n              align-middle\r\n              border-b border-gray-200\r\n              shadow\r\n              sm:rounded-lg\r\n            \"\r\n          >\r\n            <table class=\"min-w-full\">\r\n              <thead>\r\n                <tr>\r\n                  <th\r\n                    class=\"\r\n                      px-5\r\n                      py-3\r\n                      text-sm\r\n                      font-medium\r\n                      text-gray-100\r\n                      uppercase\r\n                      bg-indigo-800\r\n                    \"\r\n                  >\r\n                    Name\r\n                  </th>\r\n                </tr>\r\n              </thead>\r\n\r\n              <tbody class=\"bg-white\">\r\n                <tr\r\n                  v-for=\"transporteur in checkedTransporteur\"\r\n                  :key=\"transporteur.idTransporteur\"\r\n                >\r\n                 <td\r\n                    class=\"\r\n                      px-6\r\n                      py-4\r\n                      border-b\r\n                      text-center\r\n                      border-gray-200\r\n                      whitespace-nowrap\r\n                      text-center\r\n                    \"\r\n                  >\r\n                    <div class=\"flex justify-around\">\r\n                      <div class=\"flex-shrink-0 w-10 h-10\">\r\n                        <img\r\n                          class=\"w-10 h-10 rounded-full\"\r\n                          :src=\"transporteur.imageSrc\"\r\n                          alt=\"\"\r\n                        />\r\n                      </div>\r\n\r\n                      <div class=\"ml-4\">\r\n                        <div class=\"px-6 py-2 border-b border-gray-200\">\r\n                          {{ transporteur.idUserNavigation.prenom }}\r\n\r\n                          {{ transporteur.idUserNavigation.nom }}\r\n                        </div>\r\n                      </div>\r\n                    </div>\r\n                  </td>\r\n                  \r\n                </tr>\r\n              </tbody>\r\n            </table>\r\n                 <div class=\"p-2 bg-white rounded-md shadow-md\"  v-if=\"ListeDemandeDevis.length == 0\">\r\n              <div class=\"grid grid-cols-1 gap-6 sm:grid-cols-2\">\r\n               \r\n                  <div class=\"text-center \">\r\n                  <div\r\n                    class=\"\r\n                      flex flex-col\r\n                      items-center\r\n                      bg-white\r\n                      xs:flex-row xs:justify-between\r\n                    \"\r\n                  >\r\n                    <div class=\"inline-flex xs:mt-0\">\r\n                      <button\r\n                        class=\"\r\n                          px-6\r\n                          py-2\r\n                          font-semibold\r\n                          text-gray-900\r\n                          bg-gray-300\r\n                          rounded-r rounded-l\r\n                          hover:bg-gray-400\r\n                        \"\r\n                       \r\n                        @click=\"Ajouter()\"\r\n                      >\r\n                        Demander\r\n                      </button>\r\n                      \r\n                    </div>\r\n\r\n                 \r\n                  </div>\r\n                </div>\r\n              </div>\r\n            </div>\r\n          </div>\r\n        </div>\r\n      </div>\r\n    </div>\r\n    <!-- {{ checkedTransporteurId }} -->\r\n    <!-- {{ ListeTransporteurs }} -->\r\n    <br />\r\n    <!-- {{$route.params.id}} -->\r\n    <br />\r\n    <!-- {{ ChercherVille1 }} kkk{{ ChercherVille2 }} -->\r\n    <!-- {{ checkedTransporteurId.length }} -->\r\n    <br />\r\n    <!-- {{ checkedTransporteur }} -->\r\n    <!-- {{ ListeDemacheckedTransporteurIdndeDevis }} -->\r\n  </div>\r\n  <!-- </div> -->\r\n</template>\r\n<script>\r\nimport swal from \"sweetalert2\";\r\nwindow.Swal = swal;\r\nimport axios from \"axios\";\r\nimport Url from \"../../../store/Api\";\r\nimport { mapGetters } from \"vuex\";\r\nimport BreadCrumb from \"../../../components/Intermediaire/BreadCrumb.vue\";\r\nimport PaginationVue from \"../../../components/Intermediaire/pagination/PaginationVue.vue\";\r\nexport default {\r\n  components: {\r\n    BreadCrumb,\r\n    PaginationVue,\r\n  },\r\n  data() {\r\n    return {\r\n      ParpageTransporteur: \"1\",\r\n      rechercheTransporteur: \"\",\r\n      rechercheVille1: \"\",\r\n      rechercheVille2: \"\",\r\n      Description: \"\",\r\n      DateCreation: \"\",\r\n      AdressDepart: \"\",\r\n      AdressArrive: \"\",\r\n      IdEtatDemande: \"\",\r\n      IdClient: \"\",\r\n      Date: \"\",\r\n      Poids: \"\",\r\n      Largeur: \"\",\r\n      Hauteur: \"\",\r\n      checkedTransporteur: [],\r\n      checkedTransporteurId: [],\r\n    };\r\n  },\r\n  computed: {\r\n    ...mapGetters([\r\n      \"ListeTransporteurs\",\r\n      \"ListeEtatDemandeDevis\",\r\n      \"ListeDemandeDevis\",\r\n      \"ListeEtatDemandeLivraisons\",\r\n      \"currentTransporteur\",\r\n      \"perPageTransporteur\",\r\n      \"parPageTransporteur\",\r\n      \"totalTransporteur\",\r\n      \"ChercherVille1\",\r\n      \"ChercherVille2\",\r\n    ]),\r\n  },\r\n  mounted() {\r\n    this.$store.dispatch(\"Get_Transporteur\");\r\n    this.$store.dispatch(\"Get_EtatDemandeDevi\");\r\n    this.$store.dispatch(\"Get_DemandeDevi\", this.$route.params.id);\r\n    this.$store.dispatch(\"Get_EtatDemandeLivraison\");\r\n  },\r\n  async created() {\r\n    await axios\r\n      .get(Url + `DemandeDevis/${this.$route.params.id}`, {\r\n        headers: {\r\n          Authorization: \"Bearer \" + localStorage.getItem(\"token\"),\r\n        },\r\n      })\r\n      .then((res) => {\r\n        this.checkedTransporteurId = res.data\r\n          .map((el) => el.idTransporteurNavigation)\r\n          .map((el) => el.idTransporteur);\r\n          this.checkedTransporteur=res.data.map((el) => el.idTransporteurNavigation);\r\n      });\r\n\r\n    await axios\r\n      .get(Url + \"DemandeLivraisons/\" + this.$route.params.id, {\r\n        headers: {\r\n          Authorization: \"Bearer \" + localStorage.getItem(\"token\"),\r\n        },\r\n      })\r\n      .then((res) => {\r\n        console.log(res.data[0]);\r\n        this.id = res.data[0].idDemande;\r\n        this.Description = res.data[0].description;\r\n        this.DateCreation = res.data[0].datecreation;\r\n        this.AdressDepart = res.data[0].adressdepart;\r\n        this.AdressArrive = res.data[0].adressarrive;\r\n        this.IdEtatDemande = res.data[0].idEtatdemande;\r\n        this.IdClient = res.data[0].idclient;\r\n        this.Date = res.data[0].date;\r\n        this.Poids = res.data[0].poids;\r\n        this.Largeur = res.data[0].largeur;\r\n        this.Hauteur = res.data[0].hauteur;\r\n      });\r\n  },\r\n  methods: {\r\n    GetEtatDemandeDevis() {\r\n      return this.ListeEtatDemandeDevis.filter(\r\n        (el) => el.etat == \"Non traité\"\r\n      ).map((el) => el.idEtat)[0];\r\n    },\r\n    GetEtatDemande() {\r\n      return this.ListeEtatDemandeLivraisons.filter(\r\n        (el) => el.etatDemande == \"En cours de traitement\"\r\n      ).map((el) => el.idEtatDemande)[0];\r\n    },\r\n    GetEtatDemandeModifier() {\r\n      return this.ListeEtatDemandeLivraisons.filter(\r\n        (el) => el.etatDemande == \"Non traité\"\r\n      ).map((el) => el.idEtatDemande)[0];\r\n    },\r\n    Ajouter() {\r\n      let DemandeDevi = {\r\n        DateEnvoit: \"2022-04-07\",\r\n        IdIntermediaire: localStorage.getItem(\"id\"),\r\n        IdDemande: this.$route.params.id,\r\n        IdTransporteur: this.checkedTransporteurId,\r\n        IdEtat: this.GetEtatDemandeDevis(),\r\n      };\r\n\r\n      if (this.checkedTransporteurId.length != 0) {\r\n        this.$store.dispatch(\"Ajouter_DemandeDevi\", DemandeDevi);\r\n        var DemandeLivraison = {\r\n          idDemande: this.$route.params.id,\r\n          description: this.Description,\r\n          datecreation: this.DateCreation,\r\n          adressdepart: this.AdressDepart,\r\n          adressarrive: this.AdressArrive,\r\n          idEtatdemande: this.GetEtatDemande(),\r\n          idclient: this.IdClient,\r\n          Date: this.Date,\r\n          Poids: this.Poids,\r\n          Largeur: this.Largeur,\r\n          Hauteur: this.Hauteur,\r\n        };\r\n      } else {\r\n        var DemandeLivraison = {\r\n          idDemande: this.$route.params.id,\r\n          description: this.Description,\r\n          datecreation: this.DateCreation,\r\n          adressdepart: this.AdressDepart,\r\n          adressarrive: this.AdressArrive,\r\n          idEtatdemande: this.GetEtatDemandeModifier(),\r\n          idclient: this.IdClient,\r\n          Date: this.Date,\r\n          Poids: this.Poids,\r\n          Largeur: this.Largeur,\r\n          Hauteur: this.Hauteur,\r\n        };\r\n       this.$swal({\r\n          position: \"top-end\",\r\n          icon: \"error\",\r\n          toast: true,\r\n          title: \"Il faut choisir au moins transporteur\",\r\n          showConfirmButton: false,\r\n          timer: 2000,\r\n        });\r\n      }\r\n      console.log(DemandeLivraison);\r\n      // changer l'etat du demande de en cour de traitemment a traiter\r\n      axios\r\n        .put(\r\n          Url + \"DemandeLivraisons/\" + DemandeLivraison.idDemande,\r\n          DemandeLivraison,\r\n          {\r\n            headers: {\r\n              Authorization: \"Bearer \" + localStorage.getItem(\"token\"),\r\n            },\r\n          }\r\n        )\r\n        .then();\r\n    },\r\n    Modifier() {\r\n      if (this.checkedTransporteurId.length != 0) {\r\n        let DemandeDevi = {\r\n          DateEnvoit: \"2022-04-07\",\r\n          IdIntermediaire: localStorage.getItem(\"id\"),\r\n          IdDemande: this.$route.params.id,\r\n          IdTransporteur: this.checkedTransporteurId,\r\n          IdEtat: this.GetEtatDemandeDevis(),\r\n        };\r\n        console.log(DemandeDevi);\r\n        this.$store.dispatch(\"Modifier_DemandeDevi\", DemandeDevi);\r\n        this.Ajouter();\r\n      } else {\r\n        this.$swal({\r\n          position: \"top-end\",\r\n          icon: \"error\",\r\n          toast: true,\r\n          title: \"Il faut choisir au moins transporteur\",\r\n          showConfirmButton: false,\r\n          timer: 2000,\r\n        });\r\n\r\n       \r\n\r\n        \r\n      }\r\n    },\r\n    ChangePage(NumPage) {\r\n      if (this.rechercheVille1 != \"\"&&this.rechercheTransporteur != \"\") {\r\n        this.$store.dispatch(\"Get_NoveauTrajet\", NumPage);\r\n      } else {\r\n        this.$store.dispatch(\"Get_NoveauTransporteur\", NumPage);\r\n      }\r\n    },\r\n  },\r\n  watch: {\r\n    ParpageTransporteur() {\r\n      if (this.rechercheVille1 != \"\") {\r\n        this.$store.dispatch(\"Changer_ParpageTrajet\", this.ParpageTransporteur);\r\n      } else {\r\n        this.$store.dispatch(\r\n          \"Changer_ParpageTransporteur\",\r\n          this.ParpageTransporteur\r\n        );\r\n      }\r\n    },\r\n    rechercheTransporteur() {\r\n    \r\n        let ville = {\r\n          ville1: this.rechercheVille1,\r\n          name: this.rechercheTransporteur,\r\n        };\r\n        this.$store.dispatch(\"Chercher_Trajet\", ville);\r\n      \r\n    },\r\n    rechercheVille1() {\r\n      if (this.rechercheVille1 != \"\") {\r\n        let ville = {\r\n           ville1: this.rechercheVille1,\r\n          name: this.rechercheTransporteur,\r\n        \r\n        };\r\n        console.log(ville)\r\n        this.$store.dispatch(\"Chercher_Trajet\", ville);\r\n      } else {\r\n        this.$store.dispatch(\r\n          \"Get_Transporteur\",\r\n          this.rechercheTransporteur\r\n        );\r\n      }\r\n    },\r\n    \r\n    checkedTransporteurId() {\r\n      //let leng=this.checkedTransporteurId.length-1;\r\n      this.checkedTransporteur = [];\r\n      let i;\r\n      for (i = 0; i < this.checkedTransporteurId.length; i++) {\r\n        axios\r\n          .get(Url + \"Transporteurs/\" + this.checkedTransporteurId[i], {\r\n            headers: {\r\n              Authorization: \"Bearer \" + localStorage.getItem(\"token\"),\r\n            },\r\n          })\r\n          .then((res) => {\r\n            this.checkedTransporteur.push(res.data);\r\n          });\r\n      }\r\n    },\r\n    \r\n  },\r\n};\r\n</script>"]},"metadata":{},"sourceType":"module"}